<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>⚽ ProFútbol - Predicciones Deportivas Completas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
        }

        .nav-tab:hover, .nav-tab.active {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Content Sections */
        .content-section {
            display: none;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Form Elements */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #fff;
        }

        select, input {
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #ffd700;
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        select option {
            background: #fff;
            color: #333;
        }

        /* Date input specific styling */
        input[type="date"] {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            cursor: pointer;
            position: relative;
        }

        input[type="date"]::-webkit-calendar-picker-indicator {
            background: transparent;
            cursor: pointer;
            color: #333;
        }

        input[type="date"]::-webkit-inner-spin-button {
            display: none;
        }

        input[type="date"]::-webkit-clear-button {
            display: none;
        }

        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Match Cards */
        .matches-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .match-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .match-card:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .match-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .team {
            text-align: center;
            flex: 1;
        }

        .team-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .vs {
            font-size: 1.2rem;
            font-weight: 700;
            color: #ffd700;
            margin: 0 20px;
        }

        .match-info {
            text-align: center;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Enhanced Prediction Results */
        .prediction-result {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .prediction-header {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .prediction-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .prediction-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .prediction-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 8px;
            display: block;
        }

        .prediction-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: #ffd700;
        }

        .prediction-value.large {
            font-size: 2rem;
        }

        /* Score prediction styling */
        .score-prediction {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid #ffd700;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .score-display {
            font-size: 3rem;
            font-weight: 900;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            margin: 10px 0;
        }

        .both-teams-score {
            background: rgba(0, 255, 136, 0.2);
            border: 2px solid #00ff88;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        /* Statistics */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #ffd700;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        /* Progress Bars */
        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            height: 12px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 1s ease;
        }

        /* History Table */
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .history-table th,
        .history-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .history-table th {
            background: rgba(255, 255, 255, 0.1);
            font-weight: 600;
        }

        .correct { color: #4CAF50; }
        .incorrect { color: #f44336; }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .header h1 { font-size: 2rem; }
            .form-grid { grid-template-columns: 1fr; }
            .nav-tabs { flex-direction: column; align-items: center; }
            .matches-grid { grid-template-columns: 1fr; }
            .prediction-grid { grid-template-columns: 1fr; }
            .score-display { font-size: 2rem; }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error { background: #f44336; }
        .toast.warning { background: #ff9800; }

        /* Tooltip for explanations */
        [title] {
            position: relative;
            cursor: help;
        }

        [title]:hover::after {
            content: attr(title);
            position: absolute;
            bottom: 100%;
            left: 0;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 5px 10px;
            border-radius: 5px;
            white-space: nowrap;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>⚽ ProFútbol</h1>
            <p>Predicciones deportivas completas con análisis avanzado (usando datos reales via API-Football) 😊</p>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('predictor')">🔮 Predictor</button>
            <button class="nav-tab" onclick="showSection('matches')">⚽ Partidos</button>
            <button class="nav-tab" onclick="showSection('stats')">📊 Estadísticas</button>
            <button class="nav-tab" onclick="showSection('history')">📋 Historial</button>
        </div>

        <!-- Predictor Section -->
        <div id="predictor" class="content-section active">
            <h2>🔮 Generador de Predicciones Completas</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="leagueSelect" title="🏆 Selecciona la liga para cargar equipos reales">🏆 Liga:</label>
                    <select id="leagueSelect">
                        <option value="">Selecciona una liga</option>
                        <option value="laliga">🇪🇸 La Liga EA Sports</option>
                        <option value="premier">🏴󠁧󠁢󠁥󠁮󠁧󠁿 Premier League</option>
                        <option value="bundesliga">🇩🇪 Bundesliga</option>
                        <option value="fpc">🇨🇴 Liga BetPlay Colombia</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="homeTeam" title="🏠 Equipo que juega en casa (ventaja local)">🏠 Equipo Local:</label>
                    <select id="homeTeam" disabled>
                        <option value="">Selecciona liga primero</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="awayTeam" title="✈️ Equipo visitante (sin ventaja local)">✈️ Equipo Visitante:</label>
                    <select id="awayTeam" disabled>
                        <option value="">Selecciona liga primero</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="matchDate" title="📅 Debe ser una fecha futura para predicciones válidas">📅 Fecha del Partido:</label>
                    <input type="date" id="matchDate">
                </div>
            </div>

            <button class="btn" id="predictBtn" onclick="generatePrediction()" disabled>
                🎯 Generar Predicción Completa
            </button>

            <div id="predictionResult" style="display: none;"></div>
        </div>

        <!-- Matches Section -->
        <div id="matches" class="content-section">
            <h2>⚽ Partidos Próximos</h2>
            <p>Selecciona un partido para generar predicción automática</p>
            
            <div class="form-group" style="max-width: 300px;">
                <label for="matchLeague">Filtrar por liga:</label>
                <select id="matchLeague" onchange="filterMatches()">
                    <option value="">Todas las ligas</option>
                    <option value="laliga">🇪🇸 La Liga</option>
                    <option value="premier">🏴󠁧󠁢󠁥󠁮󠁧󠁿 Premier League</option>
                    <option value="bundesliga">🇩🇪 Bundesliga</option>
                    <option value="fpc">🇨🇴 Liga BetPlay</option>
                </select>
            </div>

            <div id="matchesContainer" class="matches-grid"></div>
        </div>

        <!-- Statistics Section -->
        <div id="stats" class="content-section">
            <h2>📊 Estadísticas de Ligas</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-value" id="totalPredictions">0</span>
                    <div class="stat-label">Predicciones Realizadas</div>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="accuracyRate">0%</span>
                    <div class="stat-label">Tasa de Acierto</div>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="bestLeague">-</span>
                    <div class="stat-label">Liga con Mejor Rendimiento</div>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="totalMatches">0</span>
                    <div class="stat-label">Partidos Analizados</div>
                </div>
            </div>

            <h3>📈 Rendimiento por Liga</h3>
            <div id="leagueStats"></div>
        </div>

        <!-- History Section -->
        <div id="history" class="content-section">
            <h2>📋 Historial de Predicciones</h2>
            
            <div class="form-group" style="max-width: 300px; display: flex; gap: 10px;">
                <button class="btn" onclick="clearHistory()">🗑️ Limpiar Historial</button>
                <button class="btn" onclick="exportHistoryToCSV()">📥 Exportar a CSV</button>
            </div>

            <table class="history-table" id="historyTable">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Partido</th>
                        <th>Predicción</th>
                        <th>Marcador</th>
                        <th>Ambos Marcan</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody id="historyBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // 🏆 Datos de las ligas (incluye Bundesliga y IDs de API-Football)
        const leagues = {
            laliga: {
                name: 'La Liga EA Sports',
                flag: '🇪🇸',
                api_id: 140, // ID de La Liga en API-Football
                teams: [
                    'Real Madrid', 'FC Barcelona', 'Atlético Madrid', 'Athletic Club',
                    'Real Sociedad', 'Real Betis', 'Villarreal CF', 'Valencia CF',
                    'Sevilla FC', 'Celta de Vigo', 'Rayo Vallecano', 'CA Osasuna',
                    'RCD Mallorca', 'Getafe CF', 'Deportivo Alavés', 'RCD Espanyol',
                    'Girona FC', 'UD Las Palmas', 'RC Celta', 'Cádiz CF'
                ]
            },
            premier: {
                name: 'Premier League',
                flag: '🏴󠁧󠁢󠁥󠁮󠁧󠁿',
                api_id: 39, // ID de Premier League en API-Football
                teams: [
                    'Manchester City', 'Arsenal FC', 'Liverpool FC', 'Chelsea FC',
                    'Manchester United', 'Newcastle United', 'Tottenham Hotspur',
                    'Brighton & Hove Albion', 'Aston Villa', 'West Ham United',
                    'Crystal Palace', 'Fulham FC', 'Wolverhampton Wanderers',
                    'Everton FC', 'Brentford FC', 'Nottingham Forest', 'Luton Town',
                    'AFC Bournemouth', 'Sheffield United', 'Burnley FC'
                ]
            },
            bundesliga: {
                name: 'Bundesliga',
                flag: '🇩🇪',
                api_id: 78, // ID de Bundesliga en API-Football
                teams: [
                    'FC Bayern München', 'Borussia Dortmund', 'RB Leipzig', 'Bayer Leverkusen',
                    'Eintracht Frankfurt', 'VfL Wolfsburg', 'Borussia Mönchengladbach', 'SC Freiburg',
                    'TSG Hoffenheim', 'VfB Stuttgart', '1. FC Köln', 'SV Werder Bremen',
                    '1. FC Union Berlin', 'FC Augsburg', '1. FSV Mainz 05', '1. FC Heidenheim',
                    'FC St. Pauli', 'Holstein Kiel', 'VfL Bochum', 'Hamburger SV'
                ]
            },
            fpc: {
                name: 'Liga BetPlay Colombia',
                flag: '🇨🇴',
                api_id: 239, // ID de Liga BetPlay Colombia en API-Football
                teams: [
                    'Millonarios FC', 'Atlético Nacional', 'América de Cali',
                    'Independiente Santa Fe', 'Deportes Tolima', 'Atlético Bucaramanga',
                    'Junior FC', 'Independiente Medellín', 'Once Caldas', 'La Equidad',
                    'Boyacá Chicó', 'Envigado FC', 'Patriotas Boyacá', 'Unión Magdalena',
                    'Águilas Doradas', 'Alianza FC', 'Deportivo Cali', 'Fortaleza FC',
                    'Jaguares de Córdoba', 'Deportivo Pereira'
                ]
            }
        };

        // 📊 Variables globales
        let predictionHistory = JSON.parse(localStorage.getItem('predictionHistory') || '[]');
        let upcomingMatches = [];

        // 🔧 Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            setDateRange();
            generateUpcomingMatches();
            loadStatistics();
            loadHistory();
            showToast('¡Bienvenido a ProFútbol! 4 ligas disponibles para predicciones completas con datos reales via API-Football. 😊', 'success');
        });

        function setupEventListeners() {
            document.getElementById('leagueSelect').addEventListener('change', handleLeagueChange);
            document.getElementById('homeTeam').addEventListener('change', checkPredictionReady);
            document.getElementById('awayTeam').addEventListener('change', checkPredictionReady);
            document.getElementById('matchDate').addEventListener('change', checkPredictionReady);
        }

        // 📅 Configurar rango de fechas válidas
        function setDateRange() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);
            
            const maxDate = new Date(today);
            maxDate.setMonth(today.getMonth() + 6); // 6 meses hacia adelante
            
            const dateInput = document.getElementById('matchDate');
            dateInput.min = tomorrow.toISOString().split('T')[0];
            dateInput.max = maxDate.toISOString().split('T')[0];
            
            // Establecer fecha por defecto (mañana)
            dateInput.value = tomorrow.toISOString().split('T')[0];
        }

        // 🏆 Manejar cambio de liga
        function handleLeagueChange() {
            const selectedLeague = document.getElementById('leagueSelect').value;
            const homeTeamSelect = document.getElementById('homeTeam');
            const awayTeamSelect = document.getElementById('awayTeam');

            if (selectedLeague && leagues[selectedLeague]) {
                const teams = leagues[selectedLeague].teams;
                
                // Poblar equipos locales
                homeTeamSelect.innerHTML = '<option value="">Selecciona equipo local</option>';
                awayTeamSelect.innerHTML = '<option value="">Selecciona equipo visitante</option>';
                
                teams.forEach(team => {
                    homeTeamSelect.innerHTML += `<option value="${team}">${team}</option>`;
                    awayTeamSelect.innerHTML += `<option value="${team}">${team}</option>`;
                });

                homeTeamSelect.disabled = false;
                awayTeamSelect.disabled = false;
                
                showToast(`Liga ${leagues[selectedLeague].name} seleccionada`, 'success');
            } else {
                homeTeamSelect.innerHTML = '<option value="">Selecciona liga primero</option>';
                awayTeamSelect.innerHTML = '<option value="">Selecciona liga primero</option>';
                homeTeamSelect.disabled = true;
                awayTeamSelect.disabled = true;
            }
            
            checkPredictionReady();
        }

        // ✅ Verificar si está listo para predecir (con validación de fecha futura)
        function checkPredictionReady() {
            const league = document.getElementById('leagueSelect').value;
            const homeTeam = document.getElementById('homeTeam').value;
            const awayTeam = document.getElementById('awayTeam').value;
            const matchDate = document.getElementById('matchDate').value;
            
            const today = new Date();
            const selectedDate = new Date(matchDate);
            
            const isReady = league && homeTeam && awayTeam && matchDate && homeTeam !== awayTeam && selectedDate > today;
            document.getElementById('predictBtn').disabled = !isReady;
            
            if (homeTeam && awayTeam && homeTeam === awayTeam) {
                showToast('Un equipo no puede jugar contra sí mismo ⚠️', 'error');
            }
            if (matchDate && selectedDate <= today) {
                showToast('La fecha debe ser futura para predicciones válidas 📅', 'warning');
            }
        }

        // 🎯 Generar predicción completa (ahora async para API)
        async function generatePrediction() {
            const league = document.getElementById('leagueSelect').value;
            const homeTeam = document.getElementById('homeTeam').value;
            const awayTeam = document.getElementById('awayTeam').value;
            const matchDate = document.getElementById('matchDate').value;

            if (!league || !homeTeam || !awayTeam || !matchDate) {
                showToast('Por favor completa todos los campos ⚠️', 'error');
                return;
            }

            if (homeTeam === awayTeam) {
                showToast('Selecciona equipos diferentes ⚠️', 'error');
                return;
            }

            // Mostrar loading
            document.getElementById('predictBtn').innerHTML = '<span class="loading"></span> Analizando...';
            document.getElementById('predictBtn').disabled = true;

            try {
                const prediction = await calculateCompletePrediction(homeTeam, awayTeam, league);
                displayCompletePrediction(prediction, homeTeam, awayTeam, matchDate, league);
                
                // Guardar en historial
                saveCompletePrediction(homeTeam, awayTeam, matchDate, prediction, league);
                
                showToast('¡Predicción completa generada exitosamente! 🎉', 'success');
            } catch (error) {
                showToast('Error al generar predicción: ' + error.message + ' ❌', 'error');
            } finally {
                // Restaurar botón
                document.getElementById('predictBtn').innerHTML = '🎯 Generar Predicción Completa';
                document.getElementById('predictBtn').disabled = false;
            }
        }

        // 🧮 Calcular predicción completa (con API-Football real y fallback)
        async function calculateCompletePrediction(homeTeam, awayTeam, league) {
            let homeStrength, awayStrength;
            const apiKey = '4ecc4e48dbcc799af42a31dfbc7bdc1a'; // Tu clave real de API-Football
            const leagueId = leagues[league].api_id;
            const season = new Date().getFullYear(); // Temporada actual (2025 según fecha)
            
            try {
                // Llamada a API-Football para standings (clasificaciones)
                const response = await fetch(`https://v3.football.api-sports.io/standings?league=${leagueId}&season=${season}`, {
                    headers: { 'x-apisports-key': apiKey }
                });
                
                if (!response.ok) {
                    throw new Error('Respuesta no OK de API');
                }
                
                const data = await response.json();
                
                if (data.response && data.response.length > 0 && data.response[0].league && data.response[0].league.standings) {
                    const standings = data.response[0].league.standings[0]; // Primera tabla de standings
                    
                    // Encontrar puntos del equipo local y visitante
                    const homeStanding = standings.find(team => team.team.name.toLowerCase().includes(homeTeam.toLowerCase()));
                    const awayStanding = standings.find(team => team.team.name.toLowerCase().includes(awayTeam.toLowerCase()));
                    
                    if (homeStanding && awayStanding) {
                        homeStrength = homeStanding.points + 50; // Base en puntos reales + ajuste
                        awayStrength = awayStanding.points + 40; // Ajuste para visitante
                        showToast('Usando datos reales de API-Football (standings) 📊', 'success');
                    } else {
                        throw new Error('Equipos no encontrados en standings');
                    }
                } else {
                    throw new Error('No hay datos de standings disponibles');
                }
            } catch (error) {
                showToast('⚠️ API-Football no disponible (posiblemente temporada futura), usando simulación aleatoria', 'warning');
                // Fallback a simulación original
                homeStrength = Math.random() * 35 + 65; // 65-100
                awayStrength = Math.random() * 35 + 55; // 55-90
            }
            
            const homeAdvantage = 12; // Ventaja de jugar en casa
            
            const homeTotalStrength = homeStrength + homeAdvantage;
            const awayTotalStrength = awayStrength;
            
            // Calcular probabilidades básicas
            const total = homeTotalStrength + awayTotalStrength;
            let homeWinProb = Math.round((homeTotalStrength / total) * 100);
            let awayWinProb = Math.round((awayTotalStrength / total) * 100);
            let drawProb = Math.max(100 - homeWinProb - awayWinProb, 18);
            
            // Ajustar para que sumen 100%
            const totalProb = homeWinProb + awayWinProb + drawProb;
            homeWinProb = Math.round((homeWinProb / totalProb) * 100);
            awayWinProb = Math.round((awayWinProb / totalProb) * 100);
            drawProb = 100 - homeWinProb - awayWinProb;

            // Calcular goles esperados
            const homeGoalsExpected = (homeTotalStrength / 100) * (1.5 + Math.random() * 1.5);
            const awayGoalsExpected = (awayTotalStrength / 100) * (1.2 + Math.random() * 1.3);
            
            // Generar marcador más probable
            const homeGoals = Math.round(homeGoalsExpected);
            const awayGoals = Math.round(awayGoalsExpected);
            
            // Calcular probabilidad de ambos marcan
            const homeScoreProb = Math.min(homeGoalsExpected / 3, 0.85); // Max 85%
            const awayScoreProb = Math.min(awayGoalsExpected / 3, 0.85); // Max 85%
            const bothTeamsScoreProb = Math.round(homeScoreProb * awayScoreProb * 100);

            // Determinar resultado más probable
            let predictedResult = 'Empate';
            let confidence = drawProb;
            
            if (homeWinProb > awayWinProb && homeWinProb > drawProb) {
                predictedResult = 'Victoria Local';
                confidence = homeWinProb;
            } else if (awayWinProb > homeWinProb && awayWinProb > drawProb) {
                predictedResult = 'Victoria Visitante';
                confidence = awayWinProb;
            }

            return {
                result: predictedResult,
                confidence: confidence,
                homeWinProb: homeWinProb,
                awayWinProb: awayWinProb,
                drawProb: drawProb,
                homeStrength: Math.round(homeStrength),
                awayStrength: Math.round(awayStrength),
                predictedScore: `${homeGoals}-${awayGoals}`,
                homeGoals: homeGoals,
                awayGoals: awayGoals,
                bothTeamsScore: bothTeamsScoreProb,
                keyFactors: generateKeyFactors(homeTeam, awayTeam, league),
                totalGoals: homeGoals + awayGoals,
                goalsProbability: {
                    over25: Math.round(((homeGoals + awayGoals) / 4.5) * 100),
                    under25: Math.round(100 - ((homeGoals + awayGoals) / 4.5) * 100)
                }
            };
        }

        // 🔑 Generar factores clave
        function generateKeyFactors(homeTeam, awayTeam, league) {
            const factors = [
                'Ventaja de jugar en casa (+12% rendimiento)',
                'Forma reciente del equipo local',
                'Historial de enfrentamientos directos',
                'Disponibilidad de jugadores clave',
                'Motivación y objetivos en la liga',
                'Condiciones climáticas favorables',
                'Presión de la afición local',
                'Estilo de juego y formación táctica'
            ];
            
            return factors.sort(() => 0.5 - Math.random()).slice(0, 4);
        }

        // 📊 Mostrar predicción completa
        function displayCompletePrediction(prediction, homeTeam, awayTeam, matchDate, league) {
            const resultDiv = document.getElementById('predictionResult');
            const leagueData = leagues[league];
            
            resultDiv.innerHTML = `
                <div class="prediction-result">
                    <div class="prediction-header">
                        ${leagueData.flag} ${homeTeam} vs ${awayTeam}
                    </div>
                    
                    <!-- Marcador Más Probable -->
                    <div class="score-prediction">
                        <div class="prediction-label" title="🎯 Basado en goles esperados de cada equipo">🎯 Marcador Más Probable</div>
                        <div class="score-display">${prediction.predictedScore}</div>
                        <div style="font-size: 1rem; opacity: 0.9;">
                            Basado en análisis de rendimiento ofensivo/defensivo
                        </div>
                    </div>
                    
                    <!-- Ambos Equipos Marcan -->
                    <div class="both-teams-score">
                        <div class="prediction-label" title="⚽ Probabilidad de que ambos equipos anoten al menos un gol">⚽ Ambos Equipos Marcan</div>
                        <div class="prediction-value large">${prediction.bothTeamsScore}%</div>
                        <div style="font-size: 0.9rem; margin-top: 5px;">
                            ${prediction.bothTeamsScore >= 65 ? 'ALTA PROBABILIDAD' : 
                              prediction.bothTeamsScore >= 45 ? 'PROBABILIDAD MEDIA' : 'BAJA PROBABILIDAD'}
                        </div>
                    </div>
                    
                    <!-- Probabilidades de Resultado -->
                    <div class="prediction-grid">
                        <div class="prediction-item">
                            <div class="prediction-label" title="🏠 Probabilidad de que gane el equipo local">🏠 Victoria Local</div>
                            <div class="prediction-value">${prediction.homeWinProb}%</div>
                        </div>
                        <div class="prediction-item">
                            <div class="prediction-label" title="🤝 Probabilidad de empate">🤝 Empate</div>
                            <div class="prediction-value">${prediction.drawProb}%</div>
                        </div>
                        <div class="prediction-item">
                            <div class="prediction-label" title="✈️ Probabilidad de que gane el visitante">✈️ Victoria Visitante</div>
                            <div class="prediction-value">${prediction.awayWinProb}%</div>
                        </div>
                        <div class="prediction-item">
                            <div class="prediction-label" title="📈 Nivel de confianza en la predicción principal">📈 Confianza IA</div>
                            <div class="prediction-value">${prediction.confidence}%</div>
                        </div>
                        <div class="prediction-item">
                            <div class="prediction-label" title="🎯 Goles totales esperados en el partido">🎯 Total Goles</div>
                            <div class="prediction-value">${prediction.totalGoals}</div>
                        </div>
                        <div class="prediction-item">
                            <div class="prediction-label" title="📊 Probabilidad de más de 2.5 goles (over/under)">📊 Más de 2.5 Goles</div>
                            <div class="prediction-value">${prediction.goalsProbability.over25}%</div>
                        </div>
                    </div>

                    <h4>📈 Análisis de Equipos</h4>
                    <div style="margin: 15px 0;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span>${homeTeam} (Local)</span>
                            <span>${prediction.homeStrength}/100</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${prediction.homeStrength}%"></div>
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span>${awayTeam} (Visitante)</span>
                            <span>${prediction.awayStrength}/100</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${prediction.awayStrength}%"></div>
                        </div>
                    </div>

                    <h4>🔑 Factores Clave del Análisis</h4>
                    <ul style="text-align: left; margin: 15px 0; padding-left: 20px;">
                        ${prediction.keyFactors.map(factor => `<li style="margin: 8px 0;">${factor}</li>`).join('')}
                    </ul>

                    <div style="margin-top: 20px; padding: 15px; background: rgba(255, 255, 255, 0.1); border-radius: 10px;">
                        <div style="font-size: 0.9rem; opacity: 0.9;">
                            <strong>📅 Fecha:</strong> ${new Date(matchDate).toLocaleDateString('es-ES', {
                                weekday: 'long',
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric'
                            })}<br>
                            <strong>🏆 Liga:</strong> ${leagueData.name}<br>
                            <strong>📊 Resultado Más Probable:</strong> ${prediction.result}
                        </div>
                    </div>
                </div>
            `;
            
            resultDiv.style.display = 'block';
        }

        // 💾 Guardar predicción completa (límite a 30 entradas para rendimiento)
        function saveCompletePrediction(homeTeam, awayTeam, matchDate, prediction, league) {
            const predictionData = {
                id: Date.now(),
                date: new Date().toISOString(),
                matchDate: matchDate,
                homeTeam: homeTeam,
                awayTeam: awayTeam,
                league: league,
                prediction: prediction.result,
                confidence: prediction.confidence,
                predictedScore: prediction.predictedScore,
                bothTeamsScore: prediction.bothTeamsScore,
                status: 'Pendiente'
            };
            
            predictionHistory.unshift(predictionData);
            
            // Mantener solo las últimas 30 predicciones para optimizar
            if (predictionHistory.length > 30) {
                predictionHistory = predictionHistory.slice(0, 30);
            }
            
            localStorage.setItem('predictionHistory', JSON.stringify(predictionHistory));
            loadHistory();
            loadStatistics();
        }

        // 📊 Generar partidos próximos (incluye Bundesliga)
        function generateUpcomingMatches() {
            upcomingMatches = [];
            const today = new Date();
            
            Object.keys(leagues).forEach(leagueKey => {
                const leagueTeams = leagues[leagueKey].teams;
                
                // Generar 6 partidos aleatorios por liga
                for (let i = 0; i < 6; i++) {
                    const homeTeam = leagueTeams[Math.floor(Math.random() * leagueTeams.length)];
                    let awayTeam;
                    do {
                        awayTeam = leagueTeams[Math.floor(Math.random() * leagueTeams.length)];
                    } while (awayTeam === homeTeam);
                    
                    const matchDate = new Date(today);
                    matchDate.setDate(today.getDate() + Math.floor(Math.random() * 21) + 1); // 1-21 días
                    
                    upcomingMatches.push({
                        id: Date.now() + i + Math.random() * 1000,
                        league: leagueKey,
                        homeTeam: homeTeam,
                        awayTeam: awayTeam,
                        date: matchDate,
                        time: `${Math.floor(Math.random() * 8) + 12}:${Math.random() > 0.5 ? '00' : '30'}`
                    });
                }
            });
            
            upcomingMatches.sort((a, b) => a.date - b.date);
            displayMatches();
        }

        // 📋 Mostrar partidos
        function displayMatches(filteredMatches = upcomingMatches) {
            const container = document.getElementById('matchesContainer');
            
            if (filteredMatches.length === 0) {
                container.innerHTML = '<p style="text-align: center; opacity: 0.7;">No hay partidos disponibles</p>';
                return;
            }
            
            container.innerHTML = filteredMatches.map(match => `
                <div class="match-card" onclick="selectMatch('${match.id}')">
                    <div class="match-teams">
                        <div class="team">
                            <div class="team-name">${match.homeTeam}</div>
                            <div style="font-size: 0.8rem; opacity: 0.7;">Local</div>
                        </div>
                        <div class="vs">VS</div>
                        <div class="team">
                            <div class="team-name">${match.awayTeam}</div>
                            <div style="font-size: 0.8rem; opacity: 0.7;">Visitante</div>
                        </div>
                    </div>
                    <div class="match-info">
                        ${leagues[match.league].flag} ${leagues[match.league].name}<br>
                        ${match.date.toLocaleDateString('es-ES')} - ${match.time}
                    </div>
                </div>
            `).join('');
        }

        // 🎯 Seleccionar partido
        function selectMatch(matchId) {
            const match = upcomingMatches.find(m => m.id == matchId);
            if (!match) return;
            
            // Cambiar a la sección de predictor
            showSection('predictor');
            
            // Llenar formulario
            document.getElementById('leagueSelect').value = match.league;
            handleLeagueChange();
            
            setTimeout(() => {
                document.getElementById('homeTeam').value = match.homeTeam;
                document.getElementById('awayTeam').value = match.awayTeam;
                document.getElementById('matchDate').value = match.date.toISOString().split('T')[0];
                checkPredictionReady();
            }, 100);
            
            showToast(`Partido ${match.homeTeam} vs ${match.awayTeam} seleccionado 😊`, 'success');
        }

        // 🔍 Filtrar partidos
        function filterMatches() {
            const selectedLeague = document.getElementById('matchLeague').value;
            
            if (selectedLeague) {
                const filtered = upcomingMatches.filter(match => match.league === selectedLeague);
                displayMatches(filtered);
            } else {
                displayMatches();
            }
        }

        // 📊 Cargar estadísticas
        function loadStatistics() {
            const totalPredictions = predictionHistory.length;
            const correctPredictions = predictionHistory.filter(p => p.status === 'Correcto').length;
            const accuracyRate = totalPredictions > 0 ? Math.round((correctPredictions / totalPredictions) * 100) : 0;
            
            document.getElementById('totalPredictions').textContent = totalPredictions;
            document.getElementById('accuracyRate').textContent = accuracyRate + '%';
            document.getElementById('totalMatches').textContent = upcomingMatches.length;
            
            // Mejor liga
            const leagueStats = {};
            predictionHistory.forEach(pred => {
                if (!leagueStats[pred.league]) {
                    leagueStats[pred.league] = { total: 0, correct: 0 };
                }
                leagueStats[pred.league].total++;
                if (pred.status === 'Correcto') {
                    leagueStats[pred.league].correct++;
                }
            });
            
            let bestLeague = '-';
            let bestAccuracy = 0;
            
            Object.keys(leagueStats).forEach(league => {
                const accuracy = leagueStats[league].total > 0 ? 
                    (leagueStats[league].correct / leagueStats[league].total) * 100 : 0;
                if (accuracy > bestAccuracy) {
                    bestAccuracy = accuracy;
                    bestLeague = leagues[league]?.name || league;
                }
            });
            
            document.getElementById('bestLeague').textContent = bestLeague;
            
            // Mostrar estadísticas por liga
            displayLeagueStats(leagueStats);
        }

        // 📈 Mostrar estadísticas por liga
        function displayLeagueStats(leagueStats) {
            const container = document.getElementById('leagueStats');
            
            container.innerHTML = Object.keys(leagues).map(leagueKey => {
                const stats = leagueStats[leagueKey] || { total: 0, correct: 0 };
                const accuracy = stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0;
                
                return `
                    <div style="margin: 15px 0;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span>${leagues[leagueKey].flag} ${leagues[leagueKey].name}</span>
                            <span>${accuracy}% (${stats.correct}/${stats.total})</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${accuracy}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 📋 Cargar historial (actualizado con nuevos campos y paginación básica)
        function loadHistory() {
            const tbody = document.getElementById('historyBody');
            
            if (predictionHistory.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; opacity: 0.7;">No hay predicciones en el historial</td></tr>';
                return;
            }
            
            tbody.innerHTML = predictionHistory.map(pred => `
                <tr>
                    <td>${new Date(pred.date).toLocaleDateString('es-ES')}</td>
                    <td>${leagues[pred.league]?.flag} ${pred.homeTeam} vs ${pred.awayTeam}</td>
                    <td>${pred.prediction}</td>
                    <td><strong>${pred.predictedScore || 'N/A'}</strong></td>
                    <td><strong>${pred.bothTeamsScore || 'N/A'}%</strong></td>
                    <td class="${pred.status === 'Correcto' ? 'correct' : pred.status === 'Incorrecto' ? 'incorrect' : ''}">
                        ${pred.status}
                        ${pred.status === 'Pendiente' ? 
                            `<br><button onclick="updatePredictionStatus(${pred.id}, 'Correcto')" style="margin: 2px; padding: 4px 8px; font-size: 0.8rem; background: #4CAF50; color: white; border: none; border-radius: 3px; cursor: pointer;">✓</button>
                             <button onclick="updatePredictionStatus(${pred.id}, 'Incorrecto')" style="margin: 2px; padding: 4px 8px; font-size: 0.8rem; background: #f44336; color: white; border: none; border-radius: 3px; cursor: pointer;">✗</button>` : 
                            ''
                        }
                    </td>
                </tr>
            `).join('');
        }

        // ✅ Actualizar estado de predicción
        function updatePredictionStatus(predId, status) {
            const predIndex = predictionHistory.findIndex(p => p.id === predId);
            if (predIndex !== -1) {
                predictionHistory[predIndex].status = status;
                localStorage.setItem('predictionHistory', JSON.stringify(predictionHistory));
                loadHistory();
                loadStatistics();
                showToast(`Predicción marcada como ${status.toLowerCase()} 😊`, 'success');
            }
        }

        // 🗑️ Limpiar historial
        function clearHistory() {
            if (confirm('¿Estás seguro de que quieres limpiar todo el historial?')) {
                predictionHistory = [];
                localStorage.removeItem('predictionHistory');
                loadHistory();
                loadStatistics();
                showToast('Historial limpiado 🗑️', 'success');
            }
        }

        // 📥 Exportar historial a CSV (nueva función)
        function exportHistoryToCSV() {
            if (predictionHistory.length === 0) {
                showToast('No hay historial para exportar ⚠️', 'warning');
                return;
            }
            
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Fecha,Partido,Predicción,Marcador,Ambos Marcan,Estado\n";
            
            predictionHistory.forEach(pred => {
                const row = [
                    new Date(pred.date).toLocaleDateString('es-ES'),
                    `${pred.homeTeam} vs ${pred.awayTeam}`,
                    pred.prediction,
                    pred.predictedScore || 'N/A',
                    pred.bothTeamsScore || 'N/A',
                    pred.status
                ].join(",");
                csvContent += row + "\n";
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "historial_predicciones.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('Historial exportado a CSV 📥', 'success');
        }

        // 🔄 Cambiar sección
        function showSection(sectionId) {
            // Ocultar todas las secciones
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remover clase active de todas las pestañas
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar sección seleccionada
            document.getElementById(sectionId).classList.add('active');
            
            // Agregar clase active a la pestaña correspondiente
            event.target.classList.add('active');
        }

        // 🎉 Mostrar notificación
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }
    </script>
</body>
</html>
